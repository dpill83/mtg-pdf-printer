{"ast":null,"code":"import { PDFDocument, rgb } from 'pdf-lib';\n\n// Standard Magic card dimensions (2.5\" x 3.5\")\nconst CARD_WIDTH = 2.5 * 72; // Convert inches to points (72 points per inch)\nconst CARD_HEIGHT = 3.5 * 72;\n\n// Page dimensions (A4)\nconst PAGE_WIDTH = 8.5 * 72; // 8.5 inches\nconst PAGE_HEIGHT = 11 * 72; // 11 inches\n\n// Margins (minimal)\nconst MARGIN_X = 0.25 * 72; // 0.25 inches\nconst MARGIN_Y = 0.25 * 72;\n\n// Calculate grid spacing\nconst GRID_WIDTH = PAGE_WIDTH - 2 * MARGIN_X;\nconst GRID_HEIGHT = PAGE_HEIGHT - 2 * MARGIN_Y;\nconst CARD_SPACING_X = (GRID_WIDTH - 3 * CARD_WIDTH) / 2;\nconst CARD_SPACING_Y = (GRID_HEIGHT - 3 * CARD_HEIGHT) / 2;\n\n// Convert base64 data URL to ArrayBuffer\nconst base64ToArrayBuffer = base64 => {\n  const binaryString = atob(base64.split(',')[1]);\n  const bytes = new Uint8Array(binaryString.length);\n  for (let i = 0; i < binaryString.length; i++) {\n    bytes[i] = binaryString.charCodeAt(i);\n  }\n  return bytes.buffer;\n};\nexport const generatePDF = async cards => {\n  const pdfDoc = await PDFDocument.create();\n\n  // Process cards in groups of 9 (3x3 grid per page)\n  for (let i = 0; i < cards.length; i += 9) {\n    const pageCards = cards.slice(i, i + 9);\n    const page = pdfDoc.addPage([PAGE_WIDTH, PAGE_HEIGHT]);\n\n    // Add cards to the page\n    for (let j = 0; j < pageCards.length; j++) {\n      const card = pageCards[j];\n      const row = Math.floor(j / 3);\n      const col = j % 3;\n      const x = MARGIN_X + col * (CARD_WIDTH + CARD_SPACING_X);\n      const y = PAGE_HEIGHT - MARGIN_Y - CARD_HEIGHT - row * (CARD_HEIGHT + CARD_SPACING_Y);\n      try {\n        // Use pre-loaded base64 image if available\n        if (card.base64Image) {\n          const imageBytes = base64ToArrayBuffer(card.base64Image);\n          const image = await pdfDoc.embedPng(imageBytes);\n\n          // Draw the image at the calculated position\n          page.drawImage(image, {\n            x,\n            y,\n            width: CARD_WIDTH,\n            height: CARD_HEIGHT\n          });\n        } else {\n          // Fallback: draw placeholder if no base64 image\n          throw new Error('No base64 image available');\n        }\n      } catch (error) {\n        console.error(`Error embedding image for ${card.name}:`, error);\n        // Draw a placeholder rectangle if image fails to load\n        page.drawRectangle({\n          x,\n          y,\n          width: CARD_WIDTH,\n          height: CARD_HEIGHT,\n          borderColor: rgb(0.8, 0.8, 0.8),\n          borderWidth: 1,\n          color: rgb(0.95, 0.95, 0.95)\n        });\n\n        // Add text placeholder\n        page.drawText(card.name, {\n          x: x + 5,\n          y: y + CARD_HEIGHT / 2,\n          size: 10,\n          color: rgb(0.5, 0.5, 0.5)\n        });\n      }\n    }\n  }\n\n  // Save the PDF\n  const pdfBytes = await pdfDoc.save();\n  return pdfBytes;\n};\nexport const downloadPDF = (pdfBytes, filename = 'mtg-deck.pdf') => {\n  const blob = new Blob([pdfBytes], {\n    type: 'application/pdf'\n  });\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n};","map":{"version":3,"names":["PDFDocument","rgb","CARD_WIDTH","CARD_HEIGHT","PAGE_WIDTH","PAGE_HEIGHT","MARGIN_X","MARGIN_Y","GRID_WIDTH","GRID_HEIGHT","CARD_SPACING_X","CARD_SPACING_Y","base64ToArrayBuffer","base64","binaryString","atob","split","bytes","Uint8Array","length","i","charCodeAt","buffer","generatePDF","cards","pdfDoc","create","pageCards","slice","page","addPage","j","card","row","Math","floor","col","x","y","base64Image","imageBytes","image","embedPng","drawImage","width","height","Error","error","console","name","drawRectangle","borderColor","borderWidth","color","drawText","size","pdfBytes","save","downloadPDF","filename","blob","Blob","type","url","URL","createObjectURL","link","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL"],"sources":["C:/MTG/mtg-pdf-printer/mtg-pdf-printer/src/utils/pdfGenerator.js"],"sourcesContent":["import { PDFDocument, rgb } from 'pdf-lib';\r\n\r\n// Standard Magic card dimensions (2.5\" x 3.5\")\r\nconst CARD_WIDTH = 2.5 * 72; // Convert inches to points (72 points per inch)\r\nconst CARD_HEIGHT = 3.5 * 72;\r\n\r\n// Page dimensions (A4)\r\nconst PAGE_WIDTH = 8.5 * 72; // 8.5 inches\r\nconst PAGE_HEIGHT = 11 * 72; // 11 inches\r\n\r\n// Margins (minimal)\r\nconst MARGIN_X = 0.25 * 72; // 0.25 inches\r\nconst MARGIN_Y = 0.25 * 72;\r\n\r\n// Calculate grid spacing\r\nconst GRID_WIDTH = PAGE_WIDTH - (2 * MARGIN_X);\r\nconst GRID_HEIGHT = PAGE_HEIGHT - (2 * MARGIN_Y);\r\nconst CARD_SPACING_X = (GRID_WIDTH - (3 * CARD_WIDTH)) / 2;\r\nconst CARD_SPACING_Y = (GRID_HEIGHT - (3 * CARD_HEIGHT)) / 2;\r\n\r\n// Convert base64 data URL to ArrayBuffer\r\nconst base64ToArrayBuffer = (base64) => {\r\n  const binaryString = atob(base64.split(',')[1]);\r\n  const bytes = new Uint8Array(binaryString.length);\r\n  for (let i = 0; i < binaryString.length; i++) {\r\n    bytes[i] = binaryString.charCodeAt(i);\r\n  }\r\n  return bytes.buffer;\r\n};\r\n\r\nexport const generatePDF = async (cards) => {\r\n  const pdfDoc = await PDFDocument.create();\r\n  \r\n  // Process cards in groups of 9 (3x3 grid per page)\r\n  for (let i = 0; i < cards.length; i += 9) {\r\n    const pageCards = cards.slice(i, i + 9);\r\n    const page = pdfDoc.addPage([PAGE_WIDTH, PAGE_HEIGHT]);\r\n    \r\n    // Add cards to the page\r\n    for (let j = 0; j < pageCards.length; j++) {\r\n      const card = pageCards[j];\r\n      const row = Math.floor(j / 3);\r\n      const col = j % 3;\r\n      \r\n      const x = MARGIN_X + (col * (CARD_WIDTH + CARD_SPACING_X));\r\n      const y = PAGE_HEIGHT - MARGIN_Y - CARD_HEIGHT - (row * (CARD_HEIGHT + CARD_SPACING_Y));\r\n      \r\n      try {\r\n        // Use pre-loaded base64 image if available\r\n        if (card.base64Image) {\r\n          const imageBytes = base64ToArrayBuffer(card.base64Image);\r\n          const image = await pdfDoc.embedPng(imageBytes);\r\n          \r\n          // Draw the image at the calculated position\r\n          page.drawImage(image, {\r\n            x,\r\n            y,\r\n            width: CARD_WIDTH,\r\n            height: CARD_HEIGHT,\r\n          });\r\n        } else {\r\n          // Fallback: draw placeholder if no base64 image\r\n          throw new Error('No base64 image available');\r\n        }\r\n      } catch (error) {\r\n        console.error(`Error embedding image for ${card.name}:`, error);\r\n        // Draw a placeholder rectangle if image fails to load\r\n        page.drawRectangle({\r\n          x,\r\n          y,\r\n          width: CARD_WIDTH,\r\n          height: CARD_HEIGHT,\r\n          borderColor: rgb(0.8, 0.8, 0.8),\r\n          borderWidth: 1,\r\n          color: rgb(0.95, 0.95, 0.95),\r\n        });\r\n        \r\n        // Add text placeholder\r\n        page.drawText(card.name, {\r\n          x: x + 5,\r\n          y: y + CARD_HEIGHT / 2,\r\n          size: 10,\r\n          color: rgb(0.5, 0.5, 0.5),\r\n        });\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Save the PDF\r\n  const pdfBytes = await pdfDoc.save();\r\n  return pdfBytes;\r\n};\r\n\r\nexport const downloadPDF = (pdfBytes, filename = 'mtg-deck.pdf') => {\r\n  const blob = new Blob([pdfBytes], { type: 'application/pdf' });\r\n  const url = URL.createObjectURL(blob);\r\n  \r\n  const link = document.createElement('a');\r\n  link.href = url;\r\n  link.download = filename;\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  \r\n  URL.revokeObjectURL(url);\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}